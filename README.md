# Semaphore React Native

This is a React Native package for Semaphore protocol.

## How to Import the Package

Use a Node.js package manager in your React Native app to install dependencies. For example:

```sh
# npm
npm install https://github.com/zkmopro/SemaphoreReactNative
# yarn / pnpm
yarn add https://github.com/zkmopro/SemaphoreReactNative
```

Alternatively, you can manually add it to your package.json:

```json
"dependencies": {
 "semaphore-react-native": "github:zkmopro/SemaphoreReactNative",
}
```

## How to Use the Package

Here is an example of how to integrate and use this package

### `Identity`

```ts
import { Identity } from "semaphore-react-native";

// Create a new identity with a random secret
const secret = "secret";
const secretBytes = new TextEncoder().encode(secret);
// generate an identity from privateKey
const identity = new Identity(secretBytes);
// get the identity commitment
const commitment = identity.commitment();
// get private key
const privateKey = identity.privateKey();
// get secret scalar
const secretScalar = identity.secretScalar();
// convert the type to Element to be used in Group
const toElement = identity.toElement();
```

### `Group`

```ts
import { Group } from "semaphore-react-native";

const group = new Group([identity.toElement(), identity2.toElement()]);
// get root
group.root();
```

### `Proof`

```ts
import {
    generateSemaphoreProof,
    verifySemaphoreProof,
} from "semaphore-react-native";

const message = "message";
const scope = "scope";
const treeDepth = 16;

const proof = await generateSemaphoreProof(
    identity,
    group,
    message,
    scope,
    treeDepth
);

const valid = await verifySemaphoreProof(proof);
```

## Running on a real device

Since this is a native module, you'll need to use Expo's build commands to run it on a device. Notice that, it is not available for Web yet.
We've included an example app in the example folder to help you get started and test:

```sh
cd example
```

### iOS

To run on a connected iOS simulator:

```sh
npm run ios
```

To run on a connected iOS device:

```sh
npm run ios:device
```

### Android

Set the `ANDROID_HOME` environment variable.

```sh
export ANDROID_HOME=~/Library/Android/sdk/
```

To run on Android emulator/device (if connected):

```sh
npm run android
```

## How to Build the Package

This package relies on bindings generated by the Mopro CLI.
To learn how to build Mopro bindings, refer to the [Getting Started](https://zkmopro.org/docs/getting-started) section.
If you'd like to generate custom bindings for your own circuits or proving schemes, check out the guide on how to use the Mopro CLI: [Rust Setup for Android/iOS Bindings](https://zkmopro.org/docs/setup/rust-setup).

The bindings' source is from here [semaphore-bindings](https://github.com/vivianjeng/semaphore-bindings)

Then, replace the entire bindings directory with your generated files in the following location: [Sources/MoproiOSBindings](Sources/MoproiOSBindings)

Alternatively, you can run the following commands to copy your generated bindings into the correct location:

```sh
cp -r ../path/to/your/bindings/MoproiOSBindings ./ios && \
cp -r ../path/to/your/bindings/MoproAndroidBindings/uniffi ./android/src/main/java && \
cp -r ../path/to/your/bindings/MoproAndroidBindings/jniLibs ./android/src/main
```

## iOS Module

- [`ios/IdentityModule.swift`](ios/IdentityModule.swift)
- [`ios/GroupModule.swift`](ios/GroupModule.swift)
- [`ios/ProofModule.swift`](ios/ProofModule.swift)

## Android Module

- [`android/src/main/java/expo/modules/semaphore/IdentityModule.kt`](android/src/main/java/expo/modules/semaphore/IdentityModule.kt)
- [`android/src/main/java/expo/modules/semaphore/GroupModule.kt`](android/src/main/java/expo/modules/semaphore/GroupModule.kt)
- [`android/src/main/java/expo/modules/semaphore/ProofModule.kt`](android/src/main/java/expo/modules/semaphore/ProofModule.kt)

## React Native Module

- Define React Native's module APIs to pass messages between React Native and your desired platforms.
    - [`src/index.ts`](src/index.ts)

## Community

- X account: <a href="https://twitter.com/zkmopro"><img src="https://img.shields.io/twitter/follow/zkmopro?style=flat-square&logo=x&label=zkmopro"></a>
- Telegram group: <a href="https://t.me/zkmopro"><img src="https://img.shields.io/badge/telegram-@zkmopro-blue.svg?style=flat-square&logo=telegram"></a>

## Acknowledgements

This work was initially sponsored by a joint grant from [PSE](https://pse.dev/) and [0xPARC](https://0xparc.org/). It is currently incubated by PSE.

This project is heavily inspired by [ezkl-swift-package](https://github.com/zkonduit/ezkl-swift-package) and follows a similar approach for integrating native cryptographic libraries into Swift via a Swift Package.
